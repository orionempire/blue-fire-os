/**************************************************************************
 *	bluefire-os
 *	Version: 00.00.05
 *	Author: David Davidson
 *	Name: main.c
 *	Created: Dec 7, 2011
 *	Purpose:
 *  Usage:
***************************************************************************/
#include <common_include.h>

// declared in assembly/start.asm
extern u32int var_system_memory_amount, _start;
//extern u32int _start;

// Control arrives here from assembly/start.asm
void k_main() {

	initialize_video();

	initialize_boot_console();

	// Print the welcome banner
	kset_color(DEFAULT_COLOR);
	kprintf("Welcome To ");
	kset_color(LIGHT_BLUE);
	kprintf("Blue Fire OS.\n");
	kset_color(DEFAULT_COLOR);
	kprintf("Kernel is running at virtual address: %#010x\n", (u32int)&_start);
	kprintf("Total System memory is: %d MB\n", (var_system_memory_amount /(1024 * 1024)) );

	initialize_paging() ;

	dbg_brk();
	// We must never reach this point.
	PANIC("End of k_main reached.");
}


// Prints [ OK ] in green.
void print_ok() {
	set_color( DEFAULT_COLOR );
	printf( "\r\t\t\t\t\t\t[ " );
	set_color( GREEN );
	printf( "OK" );
	set_color( DEFAULT_COLOR );
	printf( " ]\n" );
}

// Prints [ Failed ] in red.
void  print_failed() {
	set_color( DEFAULT_COLOR );
	printf( "\r\t\t\t\t\t\t[ " );
	set_color( LIGHT_RED );
	printf( "Failed" );
	set_color( DEFAULT_COLOR );
	printf( " ]\n" );
}
